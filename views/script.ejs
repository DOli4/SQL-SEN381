<% /* =====================================================================
     View: script.ejs
     Purpose:
       - Provide a simple SQL script editor with Run and Save capabilities.
       - Left pane: text area bound to the current file contents.
       - Right pane: action buttons and an Output panel for execution results.
     Data contract (from route):
       - name:    string        → file name (used in header and route params)
       - content: string        → current SQL contents of the script file
       - output:  string|null   → last execution/stdout text (optional)
     Routes used:
       - GET  /script/:name           → renders this view
       - POST /script/:name/run       → executes the current SQL (also persists if route decides)
       - POST /script/:name/save      → saves without executing
     Notes:
       - The editor form posts to /run by default. The "Save only" button overrides action/method.
       - The Output panel shows raw text returned by the server (stdout/stderr or error message).
       - CSS classes:
           .code-area  → large, monospace text area (see /public/style.css)
           .output-area → preformatted output block
     ===================================================================== */ %>

<% /* Header: show current script name and provide navigation back to the scripts list */ %>
<div class="mb-3 d-flex align-items-center justify-content-between">
  <h2 class="m-0">Editing: <span class="fw-semibold"><%= name %></span></h2>
  <a class="btn btn-outline-secondary" href="/panel">Back</a>
</div>

<% /* Editor form:
       - Default action: POST to /script/:name/run (execute)
       - Alternate action: "Save only" button posts to /script/:name/save
       - Layout: two columns (editor on the left, actions/output on the right) */ %>
<form method="post" action="/script/<%= encodeURIComponent(name) %>/run" class="row g-4">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>SQL</strong></div>
      <div class="card-body p-0">
        <% /* SQL text area:
             - Bound to `content`
             - `rows="20"` provides a comfortable editing height
             - `spellcheck="false"` avoids distracting spellcheck underlines */ %>
        <textarea name="sql" class="form-control code-area" rows="20" spellcheck="false"><%= content %></textarea>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <% /* Primary actions:
         - Run: submits the form to the default /run handler
         - Save only: overrides the form target to /save and persists without executing */ %>
    <div class="d-flex gap-2">
      <button class="btn btn-primary flex-fill">Run</button>
      <button formaction="/script/<%= encodeURIComponent(name) %>/save" formmethod="post" class="btn btn-secondary">Save only</button>
    </div>

    <% /* Output panel:
         - Displays the last execution output or remains empty on first load
         - The server sets `output` (plain text). Errors are typically prefixed with "ERROR:" */ %>
    <div class="card shadow-sm mt-4">
      <div class="card-header bg-white">Output</div>
      <pre class="output-area m-0 p-3"><%= output || '' %></pre>
    </div>
  </div>
</form>


